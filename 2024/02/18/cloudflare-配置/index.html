<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>cloudflare 配置 | ZのBlog</title><meta name="author" content="Arbitrary"><meta name="copyright" content="Arbitrary"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="安全性 WAF  waf的五个规则，也可以不用管，属于进阶玩法，把后面的基础配置完也差不多够了  Allow 允许 表达式预览： 1(cf.client.bot)  Bypass 绕过 表达式预览： 1(cf.tls_client_auth.cert_verified)  Managed Challenge 托管质询 表达式预览： 1(not cf.client.bot and cf.threat">
<meta property="og:type" content="article">
<meta property="og:title" content="cloudflare 配置">
<meta property="og:url" content="https://blog.fkcz.cc/2024/02/18/cloudflare-%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="ZのBlog">
<meta property="og:description" content="安全性 WAF  waf的五个规则，也可以不用管，属于进阶玩法，把后面的基础配置完也差不多够了  Allow 允许 表达式预览： 1(cf.client.bot)  Bypass 绕过 表达式预览： 1(cf.tls_client_auth.cert_verified)  Managed Challenge 托管质询 表达式预览： 1(not cf.client.bot and cf.threat">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tc.381183.xyz/i/1/2024/02/24/r29bv5-1.webp">
<meta property="article:published_time" content="2024-02-18T11:48:38.000Z">
<meta property="article:modified_time" content="2024-03-24T06:34:58.622Z">
<meta property="article:author" content="Arbitrary">
<meta property="article:tag" content="配置">
<meta property="article:tag" content="cloudflare">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tc.381183.xyz/i/1/2024/02/24/r29bv5-1.webp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.fkcz.cc/2024/02/18/cloudflare-%E9%85%8D%E7%BD%AE/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":60,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'cloudflare 配置',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-24 14:34:58'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/sweetalert.css"><script src="/live2d-widget/autoload.js"></script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://tc.381183.xyz/i/1/2024/02/24/r29bv5-1.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="ZのBlog"><span class="site-name">ZのBlog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">cloudflare 配置</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-02-18T11:48:38.000Z" title="发表于 2024-02-18 19:48:38">2024-02-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-24T06:34:58.622Z" title="更新于 2024-03-24 14:34:58">2024-03-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E6%8A%98%E8%85%BE/">技术折腾</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E6%8A%98%E8%85%BE/Cloudflare/">Cloudflare</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">1.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="cloudflare 配置"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/02/18/cloudflare-%E9%85%8D%E7%BD%AE/#post-comment"><span class="waline-comment-count" data-path="/2024/02/18/cloudflare-%E9%85%8D%E7%BD%AE/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="安全性">安全性</h2>
<h3 id="WAF">WAF</h3>
<blockquote>
<p>waf的五个规则，也可以不用管，属于进阶玩法，把后面的基础配置完也差不多够了</p>
</blockquote>
<h4 id="Allow-允许">Allow 允许</h4>
<p>表达式预览：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(cf.client.bot)</span><br></pre></td></tr></table></figure>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/x3ybmm-1.webp" alt="cloudflare-rule1"></p>
<h4 id="Bypass-绕过">Bypass 绕过</h4>
<p>表达式预览：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(cf.tls_client_auth.cert_verified)</span><br></pre></td></tr></table></figure>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/x58gba-1.webp" alt="cloudflare-rule2"></p>
<h4 id="Managed-Challenge-托管质询">Managed Challenge 托管质询</h4>
<p>表达式预览：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(not cf.client.bot and cf.threat_score gt 3) or (ip.geoip.country in &#123;&quot;RU&quot; &quot;UA&quot; &quot;T1&quot;&#125;) or (http.x_forwarded_for eq &quot;.&quot;)</span><br></pre></td></tr></table></figure>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/x6d0bd-1.webp" alt="cloudflare-rule3"></p>
<h4 id="JavaScript-质询">JavaScript 质询</h4>
<p>表达式预览：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(not cf.client.bot and cf.threat_score gt 10) or (http.user_agent eq &quot;&quot;) or (http.user_agent eq &quot;&quot;) or (http.user_agent contains &quot;fuck&quot;) or (http.user_agent contains &quot;lient&quot; and http.user_agent contains &quot;ttp&quot;) or (http.user_agent contains &quot;java&quot;) or (http.user_agent contains &quot;Joomla&quot;) or (http.user_agent contains &quot;libweb&quot;) or (http.user_agent contains &quot;libwww&quot;) or (http.user_agent contains &quot;PHPCrawl&quot;) or (http.user_agent contains &quot;PyCurl&quot;) or (http.user_agent contains &quot;python&quot;) or (http.user_agent contains &quot;wrk&quot;) or (http.user_agent contains &quot;hey/&quot;) or (http.user_agent contains &quot;Acunetix&quot;) or (http.user_agent contains &quot;apache&quot;) or (http.user_agent contains &quot;BackDoorBot&quot;) or (http.user_agent contains &quot;cobion&quot;) or (http.user_agent contains &quot;masscan&quot;) or (http.user_agent contains &quot;FHscan&quot;) or (http.user_agent contains &quot;scanbot&quot;) or (http.user_agent contains &quot;Gscan&quot;) or (http.user_agent contains &quot;Researchscan&quot;) or (http.user_agent contains &quot;WPScan&quot;) or (http.user_agent contains &quot;ScanAlert&quot;) or (http.user_agent contains &quot;Wprecon&quot;) or (http.user_agent contains &quot;virusdie&quot;) or (http.user_agent contains &quot;VoidEYE&quot;) or (http.user_agent contains &quot;WebShag&quot;) or (http.user_agent contains &quot;Zeus&quot;) or (http.user_agent contains &quot;zgrab&quot;) or (http.user_agent contains &quot;zmap&quot;) or (http.user_agent contains &quot;nmap&quot;) or (http.user_agent contains &quot;fimap&quot;) or (http.user_agent contains &quot;ZmEu&quot;) or (http.user_agent contains &quot;ZumBot&quot;) or (http.user_agent contains &quot;Zyborg&quot;) or (http.user_agent contains &quot;attachment&quot;) or (http.user_agent eq &quot;undefined&quot;)</span><br></pre></td></tr></table></figure>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/xg0eto-1.webp" alt="cloudflare-rule4"></p>
<h4 id="Block-阻止">Block 阻止</h4>
<p>表达式预览：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(not cf.client.bot and cf.threat_score gt 15) or (ip.geoip.asnum in &#123;59055 59054 59053 59052 59051 59028 45104 45103 45102 37963 34947 211914 134963 63727 63655 61348 55990 269939 265443 206798 206204 200756 149167 141180 140723 139144 139124 136907 131444 45090 137876 133478 132591 132203&#125;) or (http.user_agent contains &quot;80legs&quot;) or (http.user_agent contains &quot;Abonti&quot;) or (http.user_agent contains &quot;admantx&quot;) or (http.user_agent contains &quot;aipbot&quot;) or (http.user_agent contains &quot;AllSubmitter&quot;) or (http.user_agent contains &quot;Backlink&quot;) or (http.user_agent contains &quot;backlink&quot;) or (http.user_agent contains &quot;Badass&quot;) or (http.user_agent contains &quot;Bigfoot&quot;) or (http.user_agent contains &quot;blexbot&quot;) or (http.user_agent contains &quot;Buddy&quot;) or (http.user_agent contains &quot;CherryPicker&quot;) or (http.user_agent contains &quot;cloudsystemnetwork&quot;) or (http.user_agent contains &quot;cognitiveseo&quot;) or (http.user_agent contains &quot;Collector&quot;) or (http.user_agent contains &quot;cosmos&quot;) or (http.user_agent contains &quot;CrazyWebCrawler&quot;) or (http.user_agent contains &quot;Crescent&quot;) or (http.user_agent contains &quot;Devil&quot;) or (http.user_agent contains &quot;spider&quot;) or (http.user_agent contains &quot;stat&quot;) or (http.user_agent contains &quot;Appender&quot;) or (http.user_agent contains &quot;Crawler&quot;) or (http.user_agent contains &quot;DittoSpyder&quot;) or (http.user_agent contains &quot;Konqueror&quot;) or (http.user_agent contains &quot;Easou&quot;) or (http.user_agent contains &quot;Yisou&quot;) or (http.user_agent contains &quot;Etao&quot;) or (http.user_agent contains &quot;mail&quot; and http.user_agent contains &quot;olf&quot;) or (http.user_agent contains &quot;exabot.com&quot;) or (http.user_agent contains &quot;getintent&quot;) or (http.user_agent contains &quot;Grabber&quot;) or (http.user_agent contains &quot;GrabNet&quot;) or (http.user_agent contains &quot;HEADMasterSEO&quot;) or (http.user_agent contains &quot;heritrix&quot;) or (http.user_agent contains &quot;htmlparser&quot;) or (http.user_agent contains &quot;hubspot&quot;) or (http.user_agent contains &quot;Jyxobot&quot;) or (http.user_agent contains &quot;kraken&quot;) or (http.user_agent contains &quot;larbin&quot;) or (http.user_agent contains &quot;ltx71&quot;) or (http.user_agent contains &quot;leiki&quot;) or (http.user_agent contains &quot;LinkScan&quot;) or (http.user_agent contains &quot;Magnet&quot;) or (http.user_agent contains &quot;Mag-Net&quot;) or (http.user_agent contains &quot;Mechanize&quot;) or (http.user_agent contains &quot;MegaIndex&quot;) or (http.user_agent contains &quot;Metasearch&quot;) or (http.user_agent contains &quot;MJ12bot&quot;) or (http.user_agent contains &quot;moz.com&quot;) or (http.user_agent contains &quot;Navroad&quot;) or (http.user_agent contains &quot;Netcraft&quot;) or (http.user_agent contains &quot;niki-bot&quot;) or (http.user_agent contains &quot;NimbleCrawler&quot;) or (http.user_agent contains &quot;Nimbostratus&quot;) or (http.user_agent contains &quot;Ninja&quot;) or (http.user_agent contains &quot;Openfind&quot;) or (http.user_agent contains &quot;Analyzer&quot;) or (http.user_agent contains &quot;Pixray&quot;) or (http.user_agent contains &quot;probethenet&quot;) or (http.user_agent contains &quot;proximic&quot;) or (http.user_agent contains &quot;psbot&quot;) or (http.user_agent contains &quot;RankActive&quot;) or (http.user_agent contains &quot;RankingBot&quot;) or (http.user_agent contains &quot;RankurBot&quot;) or (http.user_agent contains &quot;Reaper&quot;) or (http.user_agent contains &quot;SalesIntelligent&quot;) or (http.user_agent contains &quot;Semrush&quot;) or (http.user_agent contains &quot;SEOkicks&quot;) or (http.user_agent contains &quot;spbot&quot;) or (http.user_agent contains &quot;SEOstats&quot;) or (http.user_agent contains &quot;Snapbot&quot;) or (http.user_agent contains &quot;Stripper&quot;) or (http.user_agent contains &quot;Siteimprove&quot;) or (http.user_agent contains &quot;sitesell&quot;) or (http.user_agent contains &quot;Siphon&quot;) or (http.user_agent contains &quot;Sucker&quot;) or (http.user_agent contains &quot;TenFourFox&quot;) or (http.user_agent contains &quot;TurnitinBot&quot;) or (http.user_agent contains &quot;trendiction&quot;) or (http.user_agent contains &quot;twingly&quot;) or (http.user_agent contains &quot;VidibleScraper&quot;) or (http.user_agent contains &quot;WebLeacher&quot;) or (http.user_agent contains &quot;WebmasterWorldForum&quot;) or (http.user_agent contains &quot;webmeup&quot;) or (http.user_agent contains &quot;Webster&quot;) or (http.user_agent contains &quot;Widow&quot;) or (http.user_agent contains &quot;Xaldon&quot;) or (http.user_agent contains &quot;Xenu&quot;) or (http.user_agent contains &quot;xtractor&quot;) or (http.user_agent contains &quot;Zermelo&quot;)</span><br></pre></td></tr></table></figure>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/xluo29-1.webp" alt="cloudflare-rule5"></p>
<blockquote>
<p>图片太长，中间没有截取</p>
</blockquote>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/xm0v7r-1.webp" alt="cloudflare-rule6"></p>
<h4 id="速率限制规则">速率限制规则</h4>
<blockquote>
<p>除了上方五个自定义规则外，还可以设置一条速率限制规则，这个是防止CC</p>
</blockquote>
<p>针对免费用户来说可以配置的参数比较少，主要实现的是同个 IP（10 秒内请求数&gt;n）时对其返回 429 阻止访问。</p>
<p>正常情况下<code>请求</code>建议设置为 50 以上，资源更多的站点可以考虑适当放大（以不影响正常访问为准）。最好不要低于20。如果太低了，用户正常访问都会被阻止。如果网站类型有文字、有图片、有视频，这里不要低。如果你是CF付费版，建议用托管质询，而不是直接阻止。</p>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/yzi8bw-1.webp" alt="cloudflare-rule10"></p>
<h3 id="自动程序">自动程序</h3>
<p>自动程序攻击模式打开</p>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/xq6zf8-1.webp" alt="cloudflare-rule7"></p>
<h3 id="DDoS">DDoS</h3>
<p>.<img src="https://tc.381183.xyz/i/1/2024/02/18/xt0r0h-1.webp" alt="cloudflare-rule8"></p>
<h3 id="设置">设置</h3>
<p>安全级别可以设置为高，然后可以使用页面规则为域的任意部分设置自定义安全级别。（如果直接打开I’m Under Attack!我受到攻击，这样就是任何请求会做人机验证，等待5秒钟，也就是所说的CF五秒盾：会掉收录，API无法通讯，需要写防火墙规则排除。）</p>
<p>质询通过期设置成：15分钟或者30分钟，严重可以设置5分钟（这里慎重设置，不要太低，不要太高！）<br>
浏览器完整性检查：打开</p>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/yvcftq-1.webp" alt="cloudflare-rule9"></p>
<h2 id="网络">网络</h2>
<p>有些攻击会通过TOR节点绕开CF质询，这里建议关掉洋葱路由</p>
<p><img src="https://tc.381183.xyz/i/1/2024/02/18/z7li71-1.webp" alt="cloudflare-rule11"></p>
<h2 id="进阶玩法">进阶玩法</h2>
<p>待完善。。。</p>
<p>下方是在网上看见别人发的，还没具体查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">在GitHub上,有一些开源项目可以通过监控服务器CPU负载来实现CC/DDoS防御,推荐几个:</span><br><span class="line"></span><br><span class="line">ddosploit/ddos-deflate</span><br><span class="line">一个Linux应用防火墙,可以检测DDoS和阻止DDoS攻击。它可以监控流量并在检测到攻击时自动应用iptables规则。</span><br><span class="line"></span><br><span class="line">jgmdev/ddos-deflate</span><br><span class="line">一个shell脚本,当检测到DDoS攻击时,它可以限制流入服务器的连接。可以自定义触发阈值如CPU负载。</span><br><span class="line"></span><br><span class="line">dotpy3/ddosCoffee</span><br><span class="line">一个用Python编写的轻量级DDoS防御系统,可以检测SYN flood等常见DDoS攻击,并应用iptables规则做限速。</span><br><span class="line"></span><br><span class="line">yuanbq/dataBase-Se</span><br><span class="line">一个检测数据库高负载并应对的Java应用,可以监控CPU、内存等参数,在超过阈值时触发增强数据库配置。</span><br><span class="line"></span><br><span class="line">kyl191/antiddos</span><br><span class="line">轻量级的Python网络应用防火墙,结合了fail2ban来根据流量异常和错误请求封禁IP。</span><br></pre></td></tr></table></figure>
<h2 id="参考">参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://hostloc.com/thread-1094822-1-1.html">【最新】免费版cloudflare如何防CC攻击？不需要动手写规则！-美国VPS综合讨论-全球主机交流论坛 - Powered by Discuz! (hostloc.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.tanglu.me/cloudflare-configure">cloudflare配置详解 | tanglu’s blog</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nodeseek.com/post-17576-1">求个CF抗CC抗DD的规则 (nodeseek.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://luotianyi.vc/6140.html">【CloudFlare】通用防火墙安全配置分享 – Luminous’ Home (luotianyi.vc)</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.fkcz.cc">Arbitrary</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.fkcz.cc/2024/02/18/cloudflare-%E9%85%8D%E7%BD%AE/">https://blog.fkcz.cc/2024/02/18/cloudflare-配置/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.fkcz.cc" target="_blank">ZのBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%85%8D%E7%BD%AE/">配置</a><a class="post-meta__tags" href="/tags/cloudflare/">cloudflare</a></div><div class="post_share"><div class="social-share" data-image="https://tc.381183.xyz/i/1/2024/02/24/r29bv5-1.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/02/24/%E6%9C%AA%E5%AE%8C%E6%88%90/" title="未完成"><img class="cover" src="https://tc.381183.xyz/i/1/2024/02/24/r751bc-1.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">未完成</div></div></a></div><div class="next-post pull-right"><a href="/2024/02/10/%E9%A1%B9%E7%9B%AE%E6%94%B6%E8%97%8F/" title="项目收藏"><img class="cover" src="https://tc.381183.xyz/i/1/2024/02/24/rajezc-1.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">项目收藏</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/10/21/VS-Code%E9%85%8D%E7%BD%AE/" title="VS Code配置"><img class="cover" src="https://tc.381183.xyz/i/1/2023/11/24/129ybqg-1.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-21</div><div class="title">VS Code配置</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Arbitrary</div><div class="author-info__description">胡乱折腾。。。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-number">1.</span> <span class="toc-text">安全性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WAF"><span class="toc-number">1.1.</span> <span class="toc-text">WAF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Allow-%E5%85%81%E8%AE%B8"><span class="toc-number">1.1.1.</span> <span class="toc-text">Allow 允许</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bypass-%E7%BB%95%E8%BF%87"><span class="toc-number">1.1.2.</span> <span class="toc-text">Bypass 绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Managed-Challenge-%E6%89%98%E7%AE%A1%E8%B4%A8%E8%AF%A2"><span class="toc-number">1.1.3.</span> <span class="toc-text">Managed Challenge 托管质询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JavaScript-%E8%B4%A8%E8%AF%A2"><span class="toc-number">1.1.4.</span> <span class="toc-text">JavaScript 质询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Block-%E9%98%BB%E6%AD%A2"><span class="toc-number">1.1.5.</span> <span class="toc-text">Block 阻止</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6%E8%A7%84%E5%88%99"><span class="toc-number">1.1.6.</span> <span class="toc-text">速率限制规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.2.</span> <span class="toc-text">自动程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DDoS"><span class="toc-number">1.3.</span> <span class="toc-text">DDoS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.4.</span> <span class="toc-text">设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">2.</span> <span class="toc-text">网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E7%8E%A9%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">进阶玩法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/23/VS-Code-Git-%E4%BD%BF%E7%94%A8/" title="VS Code &amp; Git 使用">VS Code &amp; Git 使用</a><time datetime="2024-03-23T07:53:46.000Z" title="发表于 2024-03-23 15:53:46">2024-03-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/20/VPS-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE/" title="VPS 安全配置"><img src="https://tc.381183.xyz/i/1/2024/03/20/124etx1-1.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="VPS 安全配置"/></a><div class="content"><a class="title" href="/2024/03/20/VPS-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE/" title="VPS 安全配置">VPS 安全配置</a><time datetime="2024-03-20T13:52:08.000Z" title="发表于 2024-03-20 21:52:08">2024-03-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/24/%E6%9C%AA%E5%AE%8C%E6%88%90/" title="未完成"><img src="https://tc.381183.xyz/i/1/2024/02/24/r751bc-1.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="未完成"/></a><div class="content"><a class="title" href="/2024/02/24/%E6%9C%AA%E5%AE%8C%E6%88%90/" title="未完成">未完成</a><time datetime="2024-02-24T08:41:10.000Z" title="发表于 2024-02-24 16:41:10">2024-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/18/cloudflare-%E9%85%8D%E7%BD%AE/" title="cloudflare 配置"><img src="https://tc.381183.xyz/i/1/2024/02/24/r29bv5-1.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="cloudflare 配置"/></a><div class="content"><a class="title" href="/2024/02/18/cloudflare-%E9%85%8D%E7%BD%AE/" title="cloudflare 配置">cloudflare 配置</a><time datetime="2024-02-18T11:48:38.000Z" title="发表于 2024-02-18 19:48:38">2024-02-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/10/%E9%A1%B9%E7%9B%AE%E6%94%B6%E8%97%8F/" title="项目收藏"><img src="https://tc.381183.xyz/i/1/2024/02/24/rajezc-1.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="项目收藏"/></a><div class="content"><a class="title" href="/2024/02/10/%E9%A1%B9%E7%9B%AE%E6%94%B6%E8%97%8F/" title="项目收藏">项目收藏</a><time datetime="2024-02-10T11:55:26.000Z" title="发表于 2024-02-10 19:55:26">2024-02-10</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Arbitrary</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">I wish you to become your own sun, no need to rely on who's light.
<p>
<a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a>&nbsp;
<a target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a>&nbsp;
<a target="_blank" href="https://www.cloudflare.com/"><img src="https://img.shields.io/badge/CDN-Cloudflare-orange?style=flat&logo=Cloudflare" title="本站使用Cloudflare为静态资源提供CDN加速"></a>&nbsp;
<a target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;
<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a>
</p>
当前CDN节点: <span id="cdn"></span>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="/js/tw_cn.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://www.hxnb.eu.org',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
    }, {"locale":{"placeholder":"小站已开启评论审核，可匿名评论，但评论需要通过审核后才能够出现在评论区哦~"},"emoji":["https://unpkg.com/@waline/emojis@1.2.0/alus","https://unpkg.com/@waline/emojis@1.2.0/weibo","https://unpkg.com/@waline/emojis@1.2.0/bilibili","https://unpkg.com/@waline/emojis@1.2.0/bmoji","https://unpkg.com/@waline/emojis@1.2.0/qq","https://unpkg.com/@waline/emojis@1.2.0/tieba","https://unpkg.com/@waline/emojis@1.2.0/tw-emoji"],"pageSize":10,"highlight":true}))

    const destroyWaline = () => {
      waline.destroy()
    }

    btf.addGlobalFn('pjax', destroyWaline, 'destroyWaline')

  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/@waline/client@3.0.0-alpha.8/dist/waline.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/@waline/client@3.0.0-alpha.8/dist/waline.umd.min.js')
      initWaline()
    }
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script><script async src="/js/diytitle.js"></script><script async src="/js/cfcdn.js"></script><script src="/js/sweetalert.js"></script><script type="text/javascript" src ="/js/welcome.js" ></script><script async src="https://npm.elemecdn.com/tzy-blog/lib/js/other/sakura.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div></body></html>